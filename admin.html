<!doctype html>
<html lang="vi"><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ADMIN PANEL – iBYPASS SHOP</title>
<style>
  :root{--pri:#ff0066;--bg:#0a0000;--card:#110000}
  body{margin:0;font-family:Segoe UI,sans-serif;background:var(--bg);color:#ffcccc;min-height:100vh;background:radial-gradient(circle at center,rgba(255,0,102,0.15),#0a0000)}
  header{background:rgba(15,0,0,0.95);border-bottom:2px solid var(--pri);padding:16px;text-align:center;font-size:28px;font-weight:900;color:var(--pri)}
  .container{max-width:1100px;margin:20px auto;padding:20px}
  .card{background:var(--card);border:2px solid var(--pri);border-radius:16px;padding:24px;margin-bottom:24px;box-shadow:0 8px 30px rgba(255,0,102,0.3)}
  table{width:100%;border-collapse:collapse;background:#110000;border-radius:12px;overflow:hidden}
  th{background:var(--pri);color:#000;padding:16px;text-align:center}
  td{padding:14px;text-align:center;border-bottom:1px solid #330000}
  .btn{background:var(--pri);color:#000;padding:10px 20px;border:none;border-radius:10px;font-weight:700;cursor:pointer;margin:4px}
  .btn-green{background:#00ff9d;color:#000}
  .logout{background:#333;color:#fff;margin-top:20px;padding:14px 40px;font-size:18px}
  .stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin-bottom:30px}
  .stat{background:#200;border:1px solid var(--pri);padding:20px;border-radius:12px;text-align:center;font-size:24px}
  .stat span{color:var(--pri);font-weight:900}
</style>
</head><body>

<header>ADMIN PANEL – iBYPASS SHOP</header>

<div class="container">
  <div class="stats">
    <div class="stat">
      <div>Tổng khách</div>
      <span id="totalUsers">0</span>
    </div>
    <div class="stat">
      <div>Đơn chờ xử lý</div>
      <span id="pendingCount">0</span>
    </div>
    <div class="stat">
      <div>Nạp chờ duyệt</div>
      <span id="topupCount">0</span>
    </div>
    <div class="stat">
      <div>Tổng doanh thu hôm nay</div>
      <span id="todayRevenue">0</span>₫
    </div>
  </div>

  <div class="card">
    <h2 style="color:var(--pri);text-align:center">ĐƠN HÀNG CHỜ XỬ LÝ</h2>
    <div id="orders"></div>
  </div>

  <div class="card">
    <h2 style="color:#00d4ff;text-align:center">NẠP TIỀN CHỜ DUYỆT</h2>
    <div id="topups"></div>
  </div>

  <button class="logout" onclick="logout()">Đăng xuất Admin</button>
</div>

<script>
const ADMIN_USER = "998822jj";
const ADMIN_PASS = "yeugame22";

if(localStorage.getItem('admin')!=='true' || !prompt('Nhập mật khẩu admin:')===yeugame22')){
  alert('Sai mật khẩu hoặc không có quyền!');
  location.href='index.html';
}else{
  localStorage.setItem('admin','true');
}

function $(s){return document.querySelector(s)}
function get(k){return JSON.parse(localStorage.getItem(k)||'[]')}
function set(k,v){localStorage.setItem(k,JSON.stringify(v))}

function render(){
  const pending=get('pendingOrders')||[];
  const topup=get('pendingTopup')||[];
  const users=get('users')||[];

  $('#totalUsers').textContent=users.length;
  $('#pendingCount').textContent=pending.length;
  $('#topupCount').textContent=topup.length;

  // Doanh thu hôm nay
  const today=new Date().toLocaleDateString('vi-VN');
  let revenue=0;
  users.forEach(u=>u.orders?.forEach(o=>o.status==='success' && o.date.includes(today)? revenue+=o.price : null));
  $('#todayRevenue').textContent=revenue.toLocaleString();

  // Render đơn hàng
  let html='';
  if(pending.length===0) html='<p style="text-align:center;color:#666">Không có đơn nào chờ xử lý</p>';
  pending.forEach(o=>{
    html+=`<div style="background:#200;padding:16px;margin:12px 0;border-radius:12px;border-left:5px solid #ffaa00">
      <b>${o.email}</b> – ${o.name}<br>
      Giá: <b>${o.price.toLocaleString()}₫</b> – SN: <code>${o.seri}</code><br>
      Thời gian: ${o.date}
      <div style="margin-top:10px">
        <button class="btn btn-green" onclick="done('${o.orderId}','${o.email}')">SUCCESS</button>
        <button class="btn" style="background:#ff0066" onclick="refund('${o.orderId}','${o.email}',${o.price})">HOÀN TIỀN</button>
      </div>
    </div>`;
  });
  $('#orders').innerHTML=html;

  // Render nạp tiền
  html='';
  if(topup.length===0) html='<p style="text-align:center;color:#666">Không có yêu cầu nạp nào</p>';
  topup.forEach(t=>{
    html+=`<div style="background:#002;padding:16px;margin:12px 0;border-radius:12px;border-left:5px solid #00d4ff">
      <b>${t.email}</b> nạp <b>${t.amount.toLocaleString()}₫</b> – ${t.date}
      <button class="btn btn-green" style="margin-left:10px" onclick="approveTopup('${t.id}','${t.email}',${t.amount})">DUYỆT</button>
    </div>`;
  });
  $('#topups').innerHTML=html;
}

window.done=(id,email)=>{
  let users=get('users'); let u=users.find(x=>x.email===email);
  const order=u.orders.find(x=>x.id===id);
  order.status='success';
  set('users',users);
  set('pendingOrders',get('pendingOrders').filter(x=>x.orderId!==id));
  render(); alert('Đã đánh dấu SUCCESS');
}
window.refund=(id,email,price)=>{
  if(!confirm('Hoàn tiền '+price.toLocaleString()+'₫ ?')) return;
  let users=get('users'); let u=users.find(x=>x.email===email);
  u.balance+=price; u.orders.find(x=>x.id===id).status='refunded';
  set('users',users);
  set('pendingOrders',get('pendingOrders').filter(x=>x.orderId!==id));
  render(); alert('Đã hoàn tiền thành công');
}
window.approveTopup=(id,email,amount)=>{
  let users=get('users'); let u=users.find(x=>x.email===email);
  if(u){u.balance=(u.balance||0)+amount;}
  set('users',users);
  set('pendingTopup',get('pendingTopup').filter(x=>x.id!==id));
  render(); alert('Đã duyệt nạp '+amount.toLocaleString()+'₫');
}
function logout(){localStorage.removeItem('admin');location.href='index.html';}

render(); setInterval(render,5000);
</script>
</body></html>
