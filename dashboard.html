<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>iBYPASS SHOP - Cá»­a hÃ ng</title>
  <style>
    :root{--pri:#00ff9d;--bg:#0a0a0f;--card:#111118;--warn:#ff6b6b}
    body{margin:0;font-family:Segoe UI,sans-serif;background:var(--bg);color:#e0e7ff;min-height:100vh}
    header{position:sticky;top:0;z-index:99;background:rgba(10,10,15,0.95);backdrop-filter:blur(12px);border-bottom:1px solid #333;padding:14px 20px;display:flex;justify-content:space-between;align-items:center}
    .logo{font-size:30px;font-weight:900;background:linear-gradient(90deg,#00ff9d,#00d4ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    nav a{color:#e0e7ff;text-decoration:none;padding:10px 18px;border-radius:10px}
    .container{max-width:1100px;margin:0 auto;padding:20px}
    .card{background:var(--card);border:1px solid rgba(0,255,157,0.2);border-radius:18px;padding:28px;margin-bottom:24px;box-shadow:0 10px 40px #0006}
    #products{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:20px;margin-top:20px}
    .product{background:rgba(0,255,157,0.05);border:1px solid rgba(0,255,157,0.3);border-radius:16px;padding:24px;text-align:center;transition:.3s}
    .product:hover{transform:translateY(-8px);box-shadow:0 15px 30px rgba(0,255,157,0.2)}
    .product h3{font-size:20px;margin:0 0 12px;color:#00ff9d}
    .price{font-size:32px;font-weight:900;margin:16px 0;color:#00ff9d}
    .btn{background:linear-gradient(90deg,#00ff9d,#00d4ff);color:#000;padding:14px;border-radius:12px;font-weight:700;cursor:pointer}
    .btn-buy{width:100%;padding:16px;font-size:18px}
    .warning{background:#300;border:2px solid var(--warn);padding:20px;border-radius:16px}
    .status-pending{background:#ffaa0044;color:#ffaa00;padding:4px 10px;border-radius:8px}
    .status-success{background:#00ff9d44;color:#00ff9d;padding:4px 10px;border-radius:8px}
    .status-refunded{background:var(--warn)44;color:var(--warn);padding:4px 10px;border-radius:8px}
    table{width:100%;border-collapse:collapse;margin-top:20px}
    th,td{padding:12px;border-bottom:1px solid #333;text-align:left}
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.95);display:none;align-items:center;justify-content:center;z-index:999}
    .modal{max-width:500px;width:90%;background:#111;padding:30px;border-radius:18px;border:2px solid var(--pri)}
    #adminPanel{display:none;background:#100;border:2px solid #ff0066;padding:30px;border-radius:20px;margin:20px 0}
    .admin-item{background:#200;padding:16px;margin:12px 0;border-left:4px solid #ffaa00;border-radius:8px}
    .admin-topup{background:#002;border-left:4px solid #00d4ff}
  </style>
</head><body>

<header>
  <div><span class="logo">iBYPASS</span> SHOP</div>
  <nav>
    <a href="index.html">Trang chá»§</a>
    <a href="dashboard.html">Cá»­a hÃ ng</a>
    <span id="status" style="color:#00ff9d;font-weight:600">ChÆ°a Ä‘Äƒng nháº­p</span>
    <button class="btn" id="authBtn">ÄÄƒng nháº­p</button>
  </nav>
</header>

<div class="container">
  <div class="card" style="text-align:center">
    <h1 style="color:#00ff9d;font-size:36px;margin:0">Sá»‘ dÆ°: <span id="balance">0</span> VND</h1>
  </div>

  <div class="card warning">
    <h2 style="color:var(--warn)">LÆ¯U Ã CHUNG (Báº®T BUá»˜C Äá»ŒC)</h2>
    <ul style="color:#ffaa00;line-height:2;font-size:16px">
      <li>Táº¥t cáº£ dá»‹ch vá»¥ Ä‘á»u KHÃ”NG CÃ“ SÃ“NG â€“ chá»‰ dÃ¹ng WiFi</li>
      <li>KhÃ´ng há»§y Ä‘Æ¡n, nhÆ°ng cÃ³ hoÃ n tiá»n náº¿u lá»—i source quÃ¡ 48h</li>
      <li>ThÃ¡o SIM + káº¿t ná»‘i WiFi máº¡nh trÆ°á»›c khi bypass</li>
    </ul>
  </div>

  <div id="products"></div>

  <div class="card">
    <h2>Náº¡p tiá»n tá»± Ä‘á»™ng 24/7</h2>
    <p>STK: <strong>1404123456</strong> â€“ MB Bank â€“ <strong>NGUYEN DUC ANH</strong></p>
    <p>Ná»™i dung chuyá»ƒn khoáº£n: <code style="color:#00ff9d" id="emailShow">ÄÄƒng nháº­p Ä‘á»ƒ xem</code></p>
    <p style="color:#00ff9d;font-weight:700">Tiá»n sáº½ Ä‘Æ°á»£c cá»™ng tá»± Ä‘á»™ng trong <b>1â€“5 phÃºt</b> sau khi chuyá»ƒn Ä‘Ãºng ná»™i dung</p>
    <div style="display:flex;gap:12px;flex-wrap:wrap;margin-top:16px">
      <input id="topupEmail" placeholder="Email cá»§a báº¡n (pháº£i trÃ¹ng ná»™i dung chuyá»ƒn khoáº£n)" disabled>
      <input id="topupAmount" type="number" placeholder="Sá»‘ tiá»n (VD: 100000)">
      <button class="btn" id="topupBtn" disabled>TÃ´i Ä‘Ã£ chuyá»ƒn</button>
    </div>
  </div>

  <div class="card" id="history" style="display:none">
    <h2>Lá»‹ch sá»­ Ä‘Æ¡n hÃ ng</h2>
    <table><thead><tr><th>MÃ£ Ä‘Æ¡n</th><th>Sáº£n pháº©m</th><th>GiÃ¡</th><th>Seri</th><th>Tráº¡ng thÃ¡i</th><th>Thá»i gian</th></tr></thead><tbody id="tbody"></tbody></table>
  </div>

  <div id="adminPanel">
    <h2 style="color:#ff0066;text-align:center">ADMIN PANEL â€“ Quáº£n lÃ½ Ä‘Æ¡n hÃ ng & náº¡p tiá»n</h2>
    <div id="adminOrders"></div>
    <div id="adminTopups"></div>
  </div>
</div>

<div id="modalRoot" class="modal-backdrop"><div class="modal" id="modalInner"></div></div>

<script>
// ----------------------------------------------------
// THÃŠM BIáº¾N THEO DÃ•I Äá»‚ GIáº¢ Láº¬P THÃ”NG BÃO CHO ADMIN
// (GiÃ¡ trá»‹ nÃ y sáº½ Ä‘Æ°á»£c cáº­p nháº­t trong updateUI)
let lastPendingOrdersCount = 0; 
let lastPendingTopupCount = 0;
// ----------------------------------------------------

const PRODUCTS = [
  {id:1,name:"Nothing PRO Bypass iPhone 11 â†’ 17 Pro Max",price:120000,desc:"iOS 18.6â€“26.1 â€¢ Full iCloud, Notification, FaceTime â€¢ Windows Tool"},
  {id:2,name:"HFZ Activator A12+ Premium Bypass",price:120000,desc:"All iPhone/iPad â€¢ Full Notification, FaceTime â€¢ Windows"},
  {id:3,name:"iRemove Tool A12+ Instant API",price:160000,desc:"iOS 18.6â€“26.1 â€¢ Mac & Win â€¢ Tá»‘c Ä‘á»™ Instant â€¢ Full Notification"},
  {id:4,name:"Mina A12â€“M4 Bypass No Signal",price:210000,desc:"iOS 18.6â€“26.0.1 â€¢ All iPhone/iPad A12â€“M4 â€¢ Mac & Win Tool"},
  {id:5,name:"FRPFILE Activator A12+ Hello Screen",price:90000,desc:"iPhone XRâ€“17 Pro Max & iPad A12â€“M3 â€¢ Full iCloud, Notification, FaceTime"}
];

function $(s){return document.querySelector(s)}
function get(k){return JSON.parse(localStorage.getItem(k)||'[]')}
function set(k,v){localStorage.setItem(k,JSON.stringify(v))}

// HÃ€M LÆ¯U USERS (Quan trá»ng cho admin)
function saveUsers(u){localStorage.setItem('users',JSON.stringify(u))}

function currentUser(){const e=localStorage.getItem('user');return e?get('users').find(u=>u.email===e):null}

function updateUI(){
  const u = currentUser();
  $('#status').textContent = u ? u.email + (u.isAdmin ? ' (Admin)' : '') : 'ChÆ°a Ä‘Äƒng nháº­p';
  $('#status').style.color = u?.isAdmin ? '#ff0066' : '#00ff9d';
  $('#authBtn').textContent = u ? 'ÄÄƒng xuáº¥t' : 'ÄÄƒng nháº­p';
  $('#emailShow').textContent = u ? u.email : 'ÄÄƒng nháº­p Ä‘á»ƒ xem';
  $('#topupEmail').value = u ? u.email : '';
  
  // FIX: NÃºt Náº¡p tiá»n chá»‰ má»Ÿ náº¿u Ä‘Ã£ Ä‘Äƒng nháº­p VÃ€ Ä‘Ã£ Ä‘iá»n email (Ä‘á»ƒ Ä‘áº£m báº£o ná»™i dung CK Ä‘Ãºng)
  $('#topupBtn').disabled = !u || !$('#topupEmail').value; 
  $('#adminPanel').style.display = u?.isAdmin ? 'block' : 'none';

  // Render sáº£n pháº©m
  $('#products').innerHTML = '';
  PRODUCTS.forEach(p => {
    const div = document.createElement('div');
    div.className = 'product';
    div.innerHTML = `<h3>${p.name}</h3><p>${p.desc}</p><div class="price">${p.price.toLocaleString()}â‚«</div><button class="btn btn-buy" onclick="buy(${p.id})">MUA NGAY</button>`;
    $('#products').appendChild(div);
  });

  // Sá»‘ dÆ°
  $('#balance').textContent = u ? (u.balance || 0).toLocaleString() : '0';

  // Lá»‹ch sá»­
  const historyDiv = $('#history');
  const tbody = $('#tbody');
  tbody.innerHTML = '';
  if (u && u.orders && u.orders.length) {
    historyDiv.style.display = 'block';
    u.orders.forEach(o => {
      const tr = document.createElement('tr');
      const status = o.status === 'success' ? '<span class="status-success">DONE</span>' : (o.status === 'refunded' ? '<span class="status-refunded">HOÃ€N TIá»€N</span>' : '<span class="status-pending">PENDING</span>');
      tr.innerHTML = `<td>${o.id}</td><td>${o.product}</td><td>${o.price.toLocaleString()}</td><td><code>${o.seri}</code></td><td>${status}</td><td>${o.date}</td>`;
      tbody.appendChild(tr);
    });
  } else {
    historyDiv.style.display = 'none';
  }

  // Admin panel
  if (u?.isAdmin) {
    const pendingOrders = get('pendingOrders') || [];
    const pendingTopups = get('pendingTopup') || [];

    // --- LOGIC GIáº¢ Láº¬P THÃ”NG BÃO Náº P TIá»€N Má»šI ---
    if (pendingTopups.length > lastPendingTopupCount && lastPendingTopupCount !== 0) {
        // Chá»‰ thÃ´ng bÃ¡o náº¿u cÃ³ sá»± gia tÄƒng, vÃ  khÃ´ng pháº£i láº§n load Ä‘áº§u tiÃªn
        const newCount = pendingTopups.length - lastPendingTopupCount;
        alert(`ğŸ”” YÃŠU Cáº¦U Náº P Má»šI! CÃ³ ${newCount} Ä‘Æ¡n chá» duyá»‡t.`);
    }
    // Cáº­p nháº­t biáº¿n Ä‘áº¿m sau khi kiá»ƒm tra Ä‘á»ƒ láº§n sau so sÃ¡nh
    lastPendingTopupCount = pendingTopups.length;
    // ----------------------------------------------------
    
    // ÄÆ¡n hÃ ng chá» xá»­ lÃ½
    let html = '<h3 style="color:#ffaa00">ÄÆ¡n hÃ ng chá» xá»­ lÃ½ (' + pendingOrders.length + ')</h3>';
    pendingOrders.forEach(o => {
      html += `<div class="admin-item">
        <b>${o.email}</b> â€“ ${o.product} â€“ ${o.price.toLocaleString()}â‚« â€“ SN: <code>${o.seri}</code><br>${o.date}
        <button class="btn" style="background:#00ff9d;color:#000;margin:8px 4px 0 0" onclick="adminSuccess('${o.orderId}','${o.email}')">SUCCESS</button>
        <button class="btn" style="background:#ff0066" onclick="adminRefund('${o.orderId}','${o.email}',${o.price})">HOÃ€N TIá»€N</button>
      </div>`;
    });
    $('#adminOrders').innerHTML = html;

    // Náº¡p tiá»n chá» duyá»‡t
    html = '<h3 style="color:#00d4ff;margin-top:30px">Náº¡p tiá»n chá» duyá»‡t (' + pendingTopups.length + ')</h3>';
    pendingTopups.forEach(t => {
      html += `<div class="admin-item admin-topup">
        <b>${t.email}</b> náº¡p ${t.amount.toLocaleString()}â‚« â€“ ${t.date}
        <button class="btn" style="background:#00ff9d;color:#000;margin-left:10px" onclick="adminApproveTopup('${t.id}','${t.email}',${t.amount})">DUYá»†T</button>
      </div>`;
    });
    $('#adminTopups').innerHTML = html;
  }
}

// Mua hÃ ng
window.buy = id => {
  const p = PRODUCTS.find(x => x.id === id);
  const u = currentUser();
  if (!u) { alert('ÄÄƒng nháº­p trÆ°á»›c!'); location.href = 'index.html'; return; }
  if ((u.balance || 0) < p.price) { alert('KhÃ´ng Ä‘á»§ tiá»n! Náº¡p thÃªm nhÃ©'); return; }
  $('#modalInner').innerHTML = `<h3 style="color:#00ff9d">Mua ${p.name} â€“ ${p.price.toLocaleString()}â‚«</h3>
    <input id="seri" placeholder="Nháº­p Serial Number (SN)" style="width:100%;padding:14px;margin:12px 0;border-radius:12px;background:#000;color:#fff;border:1px solid #333">
    <button class="btn" onclick="confirmBuy('${p.id}','${p.name}',${p.price})">Gá»­i Ä‘Æ¡n hÃ ng</button>
    <button class="btn" style="background:#666;margin-left:8px" onclick="closeModal()">Há»§y</button>`;
  $('#modalRoot').style.display = 'flex';
};

window.confirmBuy = (id, name, price) => {
  const seri = $('#seri').value.trim();
  if (!seri) { alert('Nháº­p SN Ä‘i báº¡n!'); return; }
  let users = get('users');
  const u = users.find(x => x.email === localStorage.getItem('user'));
  u.balance -= price;
  u.orders = u.orders || [];
  const orderId = 'ORD' + Date.now();
  u.orders.unshift({id: orderId, product: name, price, seri, status: 'pending', date: new Date().toLocaleString('vi-VN')});
  saveUsers(users);

  let pending = get('pendingOrders') || [];
  pending.push({orderId, email: u.email, seri, product: name, price, date: new Date().toLocaleString('vi-VN')});
  set('pendingOrders', pending);

  // Cáº­p nháº­t UI trÆ°á»›c khi alert Ä‘á»ƒ ngÆ°á»i dÃ¹ng tháº¥y sá»‘ dÆ° thay Ä‘á»•i
  updateUI(); 
  closeModal();
  alert('ÄÆ¡n hÃ ng Ä‘Ã£ gá»­i! Chá» admin xá»­ lÃ½ trong vÃ i phÃºt.');
};

// Náº¡p tiá»n
$('#topupBtn').onclick = () => {
  const amount = parseInt($('#topupAmount').value);
  const email = $('#topupEmail').value.trim(); // ThÃªm kiá»ƒm tra email
  
  if (!email) { alert('Vui lÃ²ng Ä‘Äƒng nháº­p vÃ  Ä‘áº£m báº£o email hiá»ƒn thá»‹ Ä‘á»ƒ lÃ m ná»™i dung chuyá»ƒn khoáº£n!'); return; }
  if (isNaN(amount) || amount < 10000) { alert('Sá»‘ tiá»n tá»‘i thiá»ƒu 10k'); return; }
  
  let pending = get('pendingTopup') || [];
  pending.push({id: 'TP' + Date.now(), email: currentUser().email, amount, date: new Date().toLocaleString('vi-VN')});
  set('pendingTopup', pending);
  
  // TÄƒng biáº¿n Ä‘áº¿m giáº£ láº­p ngay sau khi táº¡o Ä‘Æ¡n
  lastPendingTopupCount = pending.length; 
  
  alert('YÃªu cáº§u náº¡p Ä‘Ã£ gá»­i! Chá» admin duyá»‡t trong 1â€“5 phÃºt.');
  $('#topupAmount').value = '';
};

// Admin functions
window.adminSuccess = (orderId, email) => {
  let users = get('users');
  const u = users.find(x => x.email === email);
  const order = u.orders.find(x => x.id === orderId);
  order.status = 'success';
  saveUsers(users);
  set('pendingOrders', get('pendingOrders').filter(x => x.orderId !== orderId));
  updateUI();
  alert('ÄÃ£ Ä‘Ã¡nh dáº¥u SUCCESS!');
};

window.adminRefund = (orderId, email, price) => {
  if (!confirm('HoÃ n tiá»n ' + price.toLocaleString() + 'â‚«?')) return;
  let users = get('users');
  const u = users.find(x => x.email === email);
  u.balance += price;
  u.orders.find(x => x.id === orderId).status = 'refunded';
  saveUsers(users);
  set('pendingOrders', get('pendingOrders').filter(x => x.orderId !== orderId));
  updateUI();
  alert('ÄÃ£ hoÃ n tiá»n thÃ nh cÃ´ng!');
};

window.adminApproveTopup = (id, email, amount) => {
  let users = get('users');
  const u = users.find(x => x.email === email);
  if (u) u.balance = (u.balance || 0) + amount;
  saveUsers(users);
  set('pendingTopup', get('pendingTopup').filter(x => x.id !== id));
  
  // Giáº£m biáº¿n Ä‘áº¿m giáº£ láº­p ngay sau khi duyá»‡t
  lastPendingTopupCount = get('pendingTopup').length; 
  
  updateUI();
  alert('ÄÃ£ duyá»‡t náº¡p ' + amount.toLocaleString() + 'â‚«!');
};

// Auth buttons
$('#authBtn').onclick = () => { 
    if (currentUser()) {
        if (confirm('ÄÄƒng xuáº¥t?')) {
            localStorage.removeItem('user');
            updateUI();
            // Náº¿u admin Ä‘ang á»Ÿ dashboard, quay vá» index.html sau logout
            location.href = 'index.html'; 
        }
    } else {
        location.href = 'index.html'; 
    }
};

// Modal functions
function closeModal() { $('#modalRoot').style.display = 'none'; }

updateUI();
setInterval(updateUI, 3000);
</script>
</body>
</html>
